
@{
    ViewBag.Title = "User2";
}



<body ng-app="UserApp">
    <div ng-controller="UserController">
            <div class="customcontainer">
                <input type="text"
                       ng-model="userIdBox"
                       placeholder="Enter UserID" />

                <b>{{user.UserName}}</b> <span id="popupmsg"></span>
                <input type="hidden" id="userid" />
                <br />
                <div class="balloon">
                    <input type="button" id="pressme" value="Press Me!" /> <span id="counter">0</span>
                </div>
                <table id="notiftable">
                    <thead>
                        <tr>
                            <td>Notification</td>
                            <td>Time sent</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="r in usernotifs | orderBy:'-'">
                            <td>{{notis[r.NotiID].desc}}</td>
                            <td><b> PreLog</b></td>
                    </tbody>
                </table>
            </div>
        </div>
</body>

@section scripts {
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <script src="~/signalr/hubs"></script>
<link href="~/css/notification.css" rel="stylesheet" />
    <script>
        $(function () {
            var nhub = $.connection.notifHub;

            nhub.client.addMessageToUser = function (message, time) {

                var msgtd = document.createElement("td");
                var timetd = document.createElement("td");
                var newtr = document.createElement("tr");

                var msgtxt = document.createTextNode(message);
                var timetxt = document.createTextNode(time);

                msgtd.appendChild(msgtxt);
                timetd.appendChild(timetxt);

                newtr.appendChild(msgtd);
                newtr.appendChild(timetd);

                newtr.style.backgroundColor = "yellow";

                $('#notiftable tbody').append(newtr);

                $('#counter').show();
                var total = document.getElementById("counter").innerHTML;
                total = parseInt(total, 10) + 1;
                document.getElementById("counter").innerHTML = total;

                $("#popupmsg").html(message);
                $("#popupmsg").slideDown(2000);
                setTimeout('$("#popupmsg").slideUp(2000);', 2000);

                // (+) send api notification.isRead = true;
            }

            $.connection.hub.start().done(function () {

                $('#popupmsg').hide();
                $('#counter').hide();


                nhub.server.addConnectionId($('#userid').val());

                $('#pressme').click(function () {
                    if ($('#notiftable').is(":visible")) {
                        $('#notiftable').toggle(200);
                    } else {
                        $('#notiftable').toggle(200);
                        document.getElementById("counter").innerHTML = 0;
                        $('#counter').hide();
                        $('#notiftable tbody tr').css("background-color", "#fff");
                    }

                });
            });
        });
    </script>
    <script src="~/Scripts/custom/UserClient.js"></script>
}